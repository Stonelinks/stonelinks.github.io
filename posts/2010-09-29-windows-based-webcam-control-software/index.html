<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/icon.png" fetchPriority="high"/><link rel="preload" as="image" href="/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg"/><link rel="stylesheet" href="/_next/static/css/0c1cbe041aef36e6.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7a6e15ce7603e944.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-06eb45215460ab53.js"/><script src="/_next/static/chunks/fd9d1056-be48aeae6e94b8d1.js" async=""></script><script src="/_next/static/chunks/23-093443f120d56e9e.js" async=""></script><script src="/_next/static/chunks/main-app-f67fffbe34eb65ac.js" async=""></script><script src="/_next/static/chunks/994-e0384b19511b091b.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-c6567c6c1ae134f3.js" async=""></script><meta name="theme-color" content="#ffffff"/><title>Windows Based Webcam Control Software - Lucas Doyle - Personal Website | Stonelinks</title><meta name="description" content="Read this post by Lucas Doyle"/><meta property="og:title" content="Windows Based Webcam Control Software"/><meta property="og:description" content="Read this post by Lucas Doyle"/><meta property="og:image" content="http://localhost:3000/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Windows Based Webcam Control Software"/><meta name="twitter:description" content="Read this post by Lucas Doyle"/><meta name="twitter:image" content="http://localhost:3000/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><div class="flex flex-col items-center min-h-screen p-6 pt-0 "><div class="flex flex-col items-center mt-6 mb-2 md:mb-8 md:flex-row md:items-center md:justify-start"><div class="mb-4 md:mb-0 md:mr-4 flex justify-center"><img alt="Logo" fetchPriority="high" width="100" height="100" decoding="async" data-nimg="1" style="color:transparent" src="/icon.png"/></div><div class="flex flex-col items-center md:items-start"><h1 class="text-4xl md:text-6xl font-serif mb-2">Stonelinks</h1><ul class="flex list-none gap-4"><li><a href="/">Home</a></li><li><a href="/posts/">Posts</a></li><li><a href="/projects/">Projects</a></li><li><a href="/luke/">About</a></li></ul></div></div><div class="max-w-3xl"><article class="p-5"><h1>Windows Based Webcam Control Software</h1><p class="text-sm text-gray-500 mt-0 mb-4">September 29, 2010</p><div class="flex flex-wrap gap-2 mb-6"><a class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5" href="/tags/systems/">systems</a><a class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5" href="/tags/arduino/">arduino</a><a class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5" href="/tags/telemetry/">telemetry</a></div><img class="mb-6" src="/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg" alt="Windows Based Webcam Control Software"/><div class="prose max-w-none mt-4"><p>I love nothing more in life than creating and tinkering with the stuff around me. Over the years, this love has taken many different forms. It started out somewhere in elementary school with Legos and taking my toys apart (much to the chagrin of my loving parents). Today it has evolved over the years into weekend projects such as the I'm about to tell you about.</p>
<p>One weekend early in the semester, I found myself with some rare free time and so I chose to make my own internet-aware pan-tilt fixture for my webcam. To my room mates <a href="http://en.wikipedia.org/wiki/Sarcasm">delight</a>, I have placed the controls to this camera on this website.</p>
<p>Projects such as this are just the kind of thing that I love taking time to do. They span the full stack, and involve concepts that go from very low level micro controller programming to high level web programming, using all sorts of code and hardware as in between. It requires quite a lot of different skill sets and knowledge of systems integration for this to work. Anyhow enough self-aggrandizing, I'll describe how I did it starting very low level at the and working my way up.</p>
<h3>Hardware</h3>
<p><img src="/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg" alt=""></p>
<p>This summer I came into possession of an <a href="http://www.arduino.cc/">Arduino</a> micro controller and <a href="http://www.rcuniverse.com/product_guide/servoprofile.cfm?servo_id=67">some servos</a>. As you can see from the pictures, I connected the servos up to the micro controller, making Y-cables for the power, ground, and signal pins of the servos. I also added a laser diode for good measure.</p>
<p>The servo signal pins were wired to the digital I/O ports on the arduino. I stuffed the Arduino in a metal box I had lying around and hot glued everything together. Predictably, the webcam itself didn't require much work. It was actually given to me for free! (previous owner couldn't find drivers for it). I just ripped the stand off of it and glued it to the servos. All in all, this was a cheap and simple that has performed very well for what it was designed to do.</p>
<h3>Microcontroller Code</h3>
<p>I wrote the following code to establish basic control of the Arduino over its USB serial adapter. The servos are controlled using a technique called pulse width modulation (PWM). The comments explain what is going on, but for further background reading you can check out <a href="http://en.wikipedia.org/wiki/Pulse-width_modulation">this</a>. It also uses EEPROM to store the position of the camera between power cycles and resets. For some background about what EEPROM is check out <a href="http://en.wikipedia.org/wiki/EEPROM">this</a>.</p>
<pre><code class="hljs language-c"><span class="hljs-comment">/*
 * File:            pantilt.c
 * Description:     A program for controlling
 *                  servos for use on a pan / tilt
 *                  module on my robot
 * Author:          Lucas Doyle (lucas.p.doyle@gmail.com)
 * Creation Date:   October 16, 2009
 * Revision Date:   Jan 31, 2010
 */</span>

<span class="hljs-comment">// Since the Arduino resets itself every time a serial connection is</span>
<span class="hljs-comment">// made in windows (if you're writing characters from PHP or something),</span>
<span class="hljs-comment">// I have chosen to use the Arduinos EEPROM to store the positions</span>
<span class="hljs-comment">// between resets. Therefore we include the EEPROM header.</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> EEPROM</span>

<span class="hljs-comment">// variables dealing with the pins</span>
<span class="hljs-type">char</span> servoPinX    =  <span class="hljs-number">2</span>;    <span class="hljs-comment">// control pin for the first servo</span>
<span class="hljs-type">char</span> servoPinY    =  <span class="hljs-number">3</span>;    <span class="hljs-comment">// control pin for the second</span>
<span class="hljs-type">char</span> laserpin     = <span class="hljs-number">13</span>;    <span class="hljs-comment">// the camera has a little laser diode on it</span>

<span class="hljs-comment">// PWM variables</span>
<span class="hljs-type">int</span> minPulseX    = <span class="hljs-number">600</span>;  <span class="hljs-comment">// minimum servo position</span>
<span class="hljs-type">int</span> maxPulseX    = <span class="hljs-number">2400</span>; <span class="hljs-comment">// maximum servo position</span>
<span class="hljs-type">int</span> minPulseY    = <span class="hljs-number">500</span>;   <span class="hljs-comment">// same thing for other servo</span>
<span class="hljs-type">int</span> maxPulseY    = <span class="hljs-number">1850</span>;
<span class="hljs-type">char</span> turnRate    = <span class="hljs-number">100</span>;  <span class="hljs-comment">// servo turn rate increment (larger value, faster rate)</span>
<span class="hljs-type">char</span> refreshTim  = <span class="hljs-number">20</span>;   <span class="hljs-comment">// time (ms) between pulses (50Hz)</span>

<span class="hljs-comment">// The Arduino will calculate these values</span>
<span class="hljs-type">int</span> centerServoX;         <span class="hljs-comment">// center servo position</span>
<span class="hljs-type">int</span> centerServoY;
<span class="hljs-type">int</span> pulseWidthX;          <span class="hljs-comment">// servo pulse width</span>
<span class="hljs-type">int</span> pulseWidthY;
<span class="hljs-type">char</span> moveServo;            <span class="hljs-comment">// raw user input</span>

<span class="hljs-type">long</span> lastPulse   = <span class="hljs-number">0</span>;     <span class="hljs-comment">// recorded time (ms) of the last pulse</span>

<span class="hljs-comment">// mode variables</span>
<span class="hljs-type">int</span> laseron      = <span class="hljs-number">0</span>;     <span class="hljs-comment">// start out with the laser off by default</span>

<span class="hljs-comment">// party mode, some stupid idea i had to have the camera</span>
<span class="hljs-comment">// spaz out and strobe the laser, has not been written yet</span>
<span class="hljs-comment">// because i have not had time</span>
<span class="hljs-type">int</span> partymode    = <span class="hljs-number">0</span>;

<span class="hljs-comment">// This function writes an int to eeprom at p_address</span>
<span class="hljs-comment">// Adapted from Marc Cardinals work:</span>
<span class="hljs-comment">// http://blog.ncode.ca/wp-content/uploads/2008/08/eeprom-int-readwrite.pde</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">EEPROMWriteInt</span><span class="hljs-params">(<span class="hljs-type">int</span> p_address, <span class="hljs-type">int</span> p_value)</span>
{
  byte lowByte = ((p_value >> <span class="hljs-number">0</span>) &#x26; <span class="hljs-number">0xFF</span>);
  byte highByte = ((p_value >> <span class="hljs-number">8</span>) &#x26; <span class="hljs-number">0xFF</span>);

  EEPROM.write(p_address, lowByte);
  EEPROM.write(p_address + <span class="hljs-number">1</span>, highByte);
}

<span class="hljs-comment">// This function reads the int back</span>
<span class="hljs-comment">// Also adapted from Marc Cardinals work:</span>
<span class="hljs-comment">// http://blog.ncode.ca/wp-content/uploads/2008/08/eeprom-int-readwrite.pde</span>
<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">EEPROMReadInt</span><span class="hljs-params">(<span class="hljs-type">int</span> p_address)</span>
{
  byte lowByte = EEPROM.read(p_address);
  byte highByte = EEPROM.read(p_address + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> ((lowByte &#x3C;&#x3C; <span class="hljs-number">0</span>) &#x26; <span class="hljs-number">0xFF</span>) + ((highByte &#x3C;&#x3C; <span class="hljs-number">8</span>) &#x26; <span class="hljs-number">0xFF00</span>); }


<span class="hljs-type">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">()</span>
{
  <span class="hljs-comment">// Set up servo and laser pins as an output</span>
  pinMode(servoPinX, OUTPUT);
  pinMode(laserpin, OUTPUT);
  pinMode(servoPinY, OUTPUT);

  <span class="hljs-comment">// calculate center positions for both servos</span>
  centerServoX = maxPulseX - ((maxPulseX - minPulseX)/<span class="hljs-number">2</span>);
  centerServoY = maxPulseY - (((maxPulseY - minPulseY)/<span class="hljs-number">2</span>)<span class="hljs-number">-280</span>);

  <span class="hljs-comment">// If you're running this for the first time on your arduino,</span>
  <span class="hljs-comment">// uncomment the next two lines to initialize the EEPROM</span>
  <span class="hljs-comment">// EEPROMWriteInt(0, centerServoX);</span>
  <span class="hljs-comment">// EEPROMWriteInt(2, centerServoY);</span>

  pulseWidthX = EEPROMReadInt(<span class="hljs-number">0</span>);
  pulseWidthY = EEPROMReadInt(<span class="hljs-number">2</span>);

  <span class="hljs-comment">// begin serial communication</span>
  Serial.begin(<span class="hljs-number">9600</span>);

  <span class="hljs-comment">//Serial.println("Arduino Serial Pan/tilt Control");</span>
  <span class="hljs-comment">//Serial.println("Standard WASD to move, spacebar to center");</span>
  <span class="hljs-comment">//Serial.println("L toggles the laser, TFGH goes to the extremes");</span>
}

<span class="hljs-type">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span>
{
  <span class="hljs-comment">// wait for serial input</span>
  <span class="hljs-keyword">if</span> (Serial.available() > <span class="hljs-number">0</span>)
  {
    <span class="hljs-comment">// read the incoming byte:</span>
    moveServo = Serial.read();

    <span class="hljs-comment">// if party mode is off, read in commands</span>
    <span class="hljs-comment">//if (partymode == 0)</span>
    {
      <span class="hljs-comment">//if (moveServo == (char) " ") {/*nothing happens*/}</span>

      <span class="hljs-comment">// move left</span>
      <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'a'</span>) { pulseWidthX = pulseWidthX - turnRate; }

      <span class="hljs-comment">// move right</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'d'</span>) { pulseWidthX = pulseWidthX + turnRate; }

      <span class="hljs-comment">// move up</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'w'</span>) { pulseWidthY = pulseWidthY - turnRate; }

      <span class="hljs-comment">// move down</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'s'</span>) { pulseWidthY = pulseWidthY + turnRate; }

      <span class="hljs-comment">// center</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'c'</span>) { pulseWidthX = centerServoX; pulseWidthY = centerServoY;}

      <span class="hljs-comment">// move hard left</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'f'</span>) {pulseWidthX = minPulseX; }

      <span class="hljs-comment">// move hard right</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'h'</span>) {pulseWidthX = maxPulseX; }

      <span class="hljs-comment">// move hard up</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'t'</span>) {pulseWidthY = minPulseY; }

      <span class="hljs-comment">// move hard down</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'g'</span>) {pulseWidthY = maxPulseY; }

      <span class="hljs-comment">// toggle the laser</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (moveServo == <span class="hljs-string">'l'</span>)
      {
        <span class="hljs-keyword">if</span> (laseron == <span class="hljs-number">0</span>) { digitalWrite(laserpin, HIGH); laseron = <span class="hljs-number">1</span>; }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (laseron == <span class="hljs-number">1</span>) { digitalWrite(laserpin, LOW); laseron = <span class="hljs-number">0</span>; }
      }
    }

    <span class="hljs-comment">// however if party mode is enabled</span>
    <span class="hljs-comment">//else if (partymode == 1)</span>
    <span class="hljs-comment">//{</span>
      <span class="hljs-comment">// do some awesome stuff (not yet implemented)</span>
    <span class="hljs-comment">//  Serial.print("Party!!! ");</span>
    <span class="hljs-comment">//}</span>

    <span class="hljs-comment">// party mode</span>
    <span class="hljs-comment">//else if (moveServo == 'p')</span>
    <span class="hljs-comment">//{</span>
    <span class="hljs-comment">//  if (partymode == 0) { partymode = 1; }</span>
    <span class="hljs-comment">//  else if (partymode == 1) { partymode = 0; }</span>
    <span class="hljs-comment">//}</span>
  }

  <span class="hljs-comment">// stop servo pulse at min and max</span>
  <span class="hljs-keyword">if</span> (pulseWidthX > maxPulseX) { pulseWidthX = maxPulseX; }
  <span class="hljs-keyword">if</span> (pulseWidthX &#x3C; minPulseX) { pulseWidthX = minPulseX; }
  <span class="hljs-keyword">if</span> (pulseWidthY > maxPulseY) { pulseWidthY = maxPulseY; }
  <span class="hljs-keyword">if</span> (pulseWidthY &#x3C; minPulseY) { pulseWidthY = minPulseY; }

  <span class="hljs-comment">// print pulseWidth back to the Serial Monitor (uncomment to debug)</span>
  <span class="hljs-comment">// Serial.print("Pulse Width: ");</span>
  <span class="hljs-comment">// Serial.print(pulseWidth);</span>
  <span class="hljs-comment">// Serial.println("us");   // microseconds</span>

  <span class="hljs-comment">// pulse the servo every 20 ms (refreshTime) with current pulseWidth</span>
  <span class="hljs-comment">// this will hold the servo's position if unchanged, or move it if changed</span>
  <span class="hljs-keyword">if</span> (millis() - lastPulse >= refreshTime)
  {
    EEPROMWriteInt(<span class="hljs-number">0</span>, pulseWidthX);
    EEPROMWriteInt(<span class="hljs-number">2</span>, pulseWidthY);

    digitalWrite(servoPinX, HIGH);   <span class="hljs-comment">// start the pulse</span>
    delayMicroseconds(pulseWidthX);  <span class="hljs-comment">// pulse width</span>
    digitalWrite(servoPinX, LOW);    <span class="hljs-comment">// end the pulse</span>

    digitalWrite(servoPinY, HIGH);   <span class="hljs-comment">// start the pulse for servo 2</span>
    delayMicroseconds(pulseWidthY);  <span class="hljs-comment">// pulse width</span>
    digitalWrite(servoPinY, LOW);    <span class="hljs-comment">// stop the pulse</span>

    lastPulse = millis();            <span class="hljs-comment">// save the time of the last pulse</span>
  }
}
</code></pre>
<h3>Establishing Serial Communication</h3>
<p>If you load the above code into the Arduino's IDE and flash it to your microcontroller, you end up with a nice, intuitive way of manually controlling your pan / tilt mechanism. You can try things out by opening the Serial Monitor in the Arduino IDE and moving around using WASD, or move to the extremes using TFGH. Pressing 'C' centers the camera back and 'L' <a href="http://spf.fotolog.com/photo/47/10/95/vanguardista2104/1211331863_f.jpg">fires the laser</a>. Arguably, you could stop here and technically still have a way of controlling the camera over the internet with the power of linux. All one would need to do is open up a terminal or ssh into the machine and run the following command:</p>
<pre><code class="hljs language-bash"> ~$ screen /dev/ttyUSB0
</code></pre>
<p>This was not good enough for me though, as I wanted to control this through a web browser, which brings us to...</p>
<h3>The Web Server</h3>
<p><img src="/2010-09-29-windows-based-webcam-control-software/2010-02-08-193241-150x150.jpg" alt=""></p>
<p>The Arduino is cool and all, but since the ultimate goal of this project is to control it over the internet, having a web server is an obvious requirement. Unfortunately for me, my web server also happens to be my self-built desktop that I use for almost all my other engineering work and day to day activities. Because of this, I need access to few windows only applications (Solidworks, LabVIEW, Photoshop, Steam, etc..) which rules out any linux server platforms if I want 100% uptime. This is an unfortunate constraint that caused me quite a lot of headaches down the line. In the future when I have another computer to spare and improve on this project, I will use the <a href="http://blog.taragana.com/wp-content/uploads/2008/03/linux-logo.jpg">right tool</a> for the job.</p>
<p>After all that rambling, you're probably wondering how I have my web server configured. The only relevant details are that I am running stock <a href="http://www.wampserver.com/en/">WampServer</a> with PHP 5.3.0 with short tags enabled.</p>
<h3>Nightmare in PHP land</h3>
<p>I thought this would be easy. Since PHP is a server side scripting language, it has libraries that allow it to read and write to and from serial ports. So one would think that something like the following would work:</p>
<pre><code class="hljs language-php"><span class="hljs-variable">$fp</span> =<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">"COM3"</span>, <span class="hljs-string">"w"</span>);
<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>, <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-string">'c'</span>)); <span class="hljs-comment">// write your character to the Arduino here</span>
<span class="hljs-title function_ invoke__">sleep</span>(1);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);
</code></pre>
<p>However, for reasons I do not completely understand, this did not work for me under Windows 7, but it did with Linux (substituting COM3 for /dev/ttyUSB0). This problem persisted, as I also tried using the <a href="http://www.phpclasses.org/browse/package/3679.html">PHP serial class</a>, but it too proved to be equally as ineffective. I finally circumvented the need for PHP to communicate with the COM port entirely by compiling several very basic exe's in <a href="http://processing.org/">processing</a> that sent individual character commands to the Arduino and then called them in PHP using the exec() function.</p>
<p>While extremely inefficient, this was the quickest, most reliable solution to my problem. Of course, this would all have been avoided in the first place had I been using Linux, as PHP has no problem writing to /dev/ttyUSB0 like it would a normal file in Linux.</p>
<h3>Building the Webpage</h3>
<p>By accessing the <a href="http://www.w3schools.com/PHP/php_get.asp">PHP $_GET</a> array, I was able to map incoming GET requests to different URLS to control what commands were sent to the camera. The PHP included in the header of the page is shown here:</p>
<pre><code class="hljs language-php"><span class="hljs-comment">// check the GET action var to see if an action is to be performed</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'action'</span>]))
{
   <span class="hljs-comment">// action required! build our command...</span>
   <span class="hljs-variable">$basecmd</span> = <span class="hljs-string">"F:\\wamp\\www\\luke\\Projects\\personal_robot\\personal robot\\commands\\"</span>;
   <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$basecmd</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'action'</span>] . <span class="hljs-string">"\\application.windows\\"</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'action'</span>] . <span class="hljs-string">".exe"</span>;
   <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$cmd</span>);
}
</code></pre>
<p>And the HTML for the rest of the page is simply a 3x3 table with some hyperlinks to the right URLs with things like <code>?action=up</code>, <code>?action=down</code>, ect. placed in the right spot.</p>
<h3>Webcam</h3>
<p>To manage the webcam feed, I am using a program called <a href="http://www.lundie.ca/fwink/">Fwink</a> to take a picture every second and then using AJAX to automatically refresh the image once the page is loaded. However, there are many ways to manage a webcam feed and the details of how you do it is out of the scope of what I'm talking about here.</p>
<h2>Conclusions and Future Improvements</h2>
<p>As expected, performance with this setup is less than impressive, but this was more a learning exercise than it was a perfect execution. I have no doubts in my mind that the low performance is due to the wonky way in which I have to execute system calls to run the Processing exes. For the future, as this is a rough prototype, a lot can be improved / simplified by moving to Linux.</p>
<p>Additionally, this is the vision component to my yet-to-be-completed personal robot, and its brains (a first generation ASUS eeepc netbook) are currently on loan to a friend of mine. Next time I see him I'll get the machine back and we'll start cooking with gas! (and by gas I mean Linux).</p></div></article><footer><hr class="py-4"/>© <a href="/luke/">Lucas Doyle</a> <!-- -->2025</footer></div></div><script src="/_next/static/chunks/webpack-06eb45215460ab53.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/0c1cbe041aef36e6.css\",\"style\"]\n2:HL[\"/_next/static/css/7a6e15ce7603e944.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5751,[],\"\"]\n6:I[9275,[],\"\"]\n8:I[1343,[],\"\"]\n9:I[8173,[\"994\",\"static/chunks/994-e0384b19511b091b.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-c6567c6c1ae134f3.js\"],\"Image\"]\na:I[231,[\"994\",\"static/chunks/994-e0384b19511b091b.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-c6567c6c1ae134f3.js\"],\"\"]\nc:I[6130,[],\"\"]\n7:[\"slug\",\"2010-09-29-windows-based-webcam-control-software\",\"d\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0c1cbe041aef36e6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"YJyU07Jx3oq2dcENbZPEh\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2010-09-29-windows-based-webcam-control-software/\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2010-09-29-windows-based-webcam-control-software\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"2010-09-29-windows-based-webcam-control-software\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2010-09-29-windows-based-webcam-control-software\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",\"$L5\"],null],null]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$7\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7a6e15ce7603e944.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center min-h-screen p-6 pt-0 \",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center mt-6 mb-2 md:mb-8 md:flex-row md:items-center md:justify-start\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-4 md:mb-0 md:mr-4 flex justify-center\",\"children\":[\"$\",\"$L9\",null,{\"src\":\"/icon.png\",\"alt\":\"Logo\",\"width\":100,\"height\":100,\"priority\":true}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center md:items-start\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-6xl font-serif mb-2\",\"children\":\"Stonelinks\"}],[\"$\",\"ul\",null,{\"className\":\"flex list-none gap-4\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/posts\",\"children\":\"Posts\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"About\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"max-w-3xl\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"404 - Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"mb-4 text-gray-600\",\"children\":\"Sorry, that page does not exist.\"}]],[\"$\",\"footer\",null,{\"children\":[[\"$\",\"hr\",null,{\"className\":\"py-4\"}],\"© \",[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"Lucas Doyle\"}],\" \",2025]}]]}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7a6e15ce7603e944.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],\"styles\":null}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]]\n"])</script><script>self.__next_f.push([1,"e:T557c,"])</script><script>self.__next_f.push([1,"\u003cp\u003eI love nothing more in life than creating and tinkering with the stuff around me. Over the years, this love has taken many different forms. It started out somewhere in elementary school with Legos and taking my toys apart (much to the chagrin of my loving parents). Today it has evolved over the years into weekend projects such as the I'm about to tell you about.\u003c/p\u003e\n\u003cp\u003eOne weekend early in the semester, I found myself with some rare free time and so I chose to make my own internet-aware pan-tilt fixture for my webcam. To my room mates \u003ca href=\"http://en.wikipedia.org/wiki/Sarcasm\"\u003edelight\u003c/a\u003e, I have placed the controls to this camera on this website.\u003c/p\u003e\n\u003cp\u003eProjects such as this are just the kind of thing that I love taking time to do. They span the full stack, and involve concepts that go from very low level micro controller programming to high level web programming, using all sorts of code and hardware as in between. It requires quite a lot of different skill sets and knowledge of systems integration for this to work. Anyhow enough self-aggrandizing, I'll describe how I did it starting very low level at the and working my way up.\u003c/p\u003e\n\u003ch3\u003eHardware\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThis summer I came into possession of an \u003ca href=\"http://www.arduino.cc/\"\u003eArduino\u003c/a\u003e micro controller and \u003ca href=\"http://www.rcuniverse.com/product_guide/servoprofile.cfm?servo_id=67\"\u003esome servos\u003c/a\u003e. As you can see from the pictures, I connected the servos up to the micro controller, making Y-cables for the power, ground, and signal pins of the servos. I also added a laser diode for good measure.\u003c/p\u003e\n\u003cp\u003eThe servo signal pins were wired to the digital I/O ports on the arduino. I stuffed the Arduino in a metal box I had lying around and hot glued everything together. Predictably, the webcam itself didn't require much work. It was actually given to me for free! (previous owner couldn't find drivers for it). I just ripped the stand off of it and glued it to the servos. All in all, this was a cheap and simple that has performed very well for what it was designed to do.\u003c/p\u003e\n\u003ch3\u003eMicrocontroller Code\u003c/h3\u003e\n\u003cp\u003eI wrote the following code to establish basic control of the Arduino over its USB serial adapter. The servos are controlled using a technique called pulse width modulation (PWM). The comments explain what is going on, but for further background reading you can check out \u003ca href=\"http://en.wikipedia.org/wiki/Pulse-width_modulation\"\u003ethis\u003c/a\u003e. It also uses EEPROM to store the position of the camera between power cycles and resets. For some background about what EEPROM is check out \u003ca href=\"http://en.wikipedia.org/wiki/EEPROM\"\u003ethis\u003c/a\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-comment\"\u003e/*\n * File:            pantilt.c\n * Description:     A program for controlling\n *                  servos for use on a pan / tilt\n *                  module on my robot\n * Author:          Lucas Doyle (lucas.p.doyle@gmail.com)\n * Creation Date:   October 16, 2009\n * Revision Date:   Jan 31, 2010\n */\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// Since the Arduino resets itself every time a serial connection is\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// made in windows (if you're writing characters from PHP or something),\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// I have chosen to use the Arduinos EEPROM to store the positions\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// between resets. Therefore we include the EEPROM header.\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e EEPROM\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// variables dealing with the pins\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e servoPinX    =  \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;    \u003cspan class=\"hljs-comment\"\u003e// control pin for the first servo\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e servoPinY    =  \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;    \u003cspan class=\"hljs-comment\"\u003e// control pin for the second\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e laserpin     = \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e;    \u003cspan class=\"hljs-comment\"\u003e// the camera has a little laser diode on it\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// PWM variables\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e minPulseX    = \u003cspan class=\"hljs-number\"\u003e600\u003c/span\u003e;  \u003cspan class=\"hljs-comment\"\u003e// minimum servo position\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e maxPulseX    = \u003cspan class=\"hljs-number\"\u003e2400\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// maximum servo position\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e minPulseY    = \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e;   \u003cspan class=\"hljs-comment\"\u003e// same thing for other servo\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e maxPulseY    = \u003cspan class=\"hljs-number\"\u003e1850\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e turnRate    = \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e;  \u003cspan class=\"hljs-comment\"\u003e// servo turn rate increment (larger value, faster rate)\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e refreshTim  = \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e;   \u003cspan class=\"hljs-comment\"\u003e// time (ms) between pulses (50Hz)\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// The Arduino will calculate these values\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e centerServoX;         \u003cspan class=\"hljs-comment\"\u003e// center servo position\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e centerServoY;\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e pulseWidthX;          \u003cspan class=\"hljs-comment\"\u003e// servo pulse width\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e pulseWidthY;\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e moveServo;            \u003cspan class=\"hljs-comment\"\u003e// raw user input\u003c/span\u003e\n\n\u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e lastPulse   = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;     \u003cspan class=\"hljs-comment\"\u003e// recorded time (ms) of the last pulse\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// mode variables\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e laseron      = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;     \u003cspan class=\"hljs-comment\"\u003e// start out with the laser off by default\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// party mode, some stupid idea i had to have the camera\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// spaz out and strobe the laser, has not been written yet\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// because i have not had time\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e partymode    = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// This function writes an int to eeprom at p_address\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Adapted from Marc Cardinals work:\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// http://blog.ncode.ca/wp-content/uploads/2008/08/eeprom-int-readwrite.pde\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eEEPROMWriteInt\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p_address, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p_value)\u003c/span\u003e\n{\n  byte lowByte = ((p_value \u003e\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xFF\u003c/span\u003e);\n  byte highByte = ((p_value \u003e\u003e \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xFF\u003c/span\u003e);\n\n  EEPROM.write(p_address, lowByte);\n  EEPROM.write(p_address + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, highByte);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// This function reads the int back\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// Also adapted from Marc Cardinals work:\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// http://blog.ncode.ca/wp-content/uploads/2008/08/eeprom-int-readwrite.pde\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eEEPROMReadInt\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p_address)\u003c/span\u003e\n{\n  byte lowByte = EEPROM.read(p_address);\n  byte highByte = EEPROM.read(p_address + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ((lowByte \u0026#x3C;\u0026#x3C; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xFF\u003c/span\u003e) + ((highByte \u0026#x3C;\u0026#x3C; \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xFF00\u003c/span\u003e); }\n\n\n\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetup\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-comment\"\u003e// Set up servo and laser pins as an output\u003c/span\u003e\n  pinMode(servoPinX, OUTPUT);\n  pinMode(laserpin, OUTPUT);\n  pinMode(servoPinY, OUTPUT);\n\n  \u003cspan class=\"hljs-comment\"\u003e// calculate center positions for both servos\u003c/span\u003e\n  centerServoX = maxPulseX - ((maxPulseX - minPulseX)/\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n  centerServoY = maxPulseY - (((maxPulseY - minPulseY)/\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\u003cspan class=\"hljs-number\"\u003e-280\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// If you're running this for the first time on your arduino,\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// uncomment the next two lines to initialize the EEPROM\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// EEPROMWriteInt(0, centerServoX);\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// EEPROMWriteInt(2, centerServoY);\u003c/span\u003e\n\n  pulseWidthX = EEPROMReadInt(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n  pulseWidthY = EEPROMReadInt(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// begin serial communication\u003c/span\u003e\n  Serial.begin(\u003cspan class=\"hljs-number\"\u003e9600\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e//Serial.println(\"Arduino Serial Pan/tilt Control\");\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e//Serial.println(\"Standard WASD to move, spacebar to center\");\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e//Serial.println(\"L toggles the laser, TFGH goes to the extremes\");\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eloop\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-comment\"\u003e// wait for serial input\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (Serial.available() \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n  {\n    \u003cspan class=\"hljs-comment\"\u003e// read the incoming byte:\u003c/span\u003e\n    moveServo = Serial.read();\n\n    \u003cspan class=\"hljs-comment\"\u003e// if party mode is off, read in commands\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//if (partymode == 0)\u003c/span\u003e\n    {\n      \u003cspan class=\"hljs-comment\"\u003e//if (moveServo == (char) \" \") {/*nothing happens*/}\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment\"\u003e// move left\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e) { pulseWidthX = pulseWidthX - turnRate; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// move right\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'd'\u003c/span\u003e) { pulseWidthX = pulseWidthX + turnRate; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// move up\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'w'\u003c/span\u003e) { pulseWidthY = pulseWidthY - turnRate; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// move down\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e's'\u003c/span\u003e) { pulseWidthY = pulseWidthY + turnRate; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// center\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e) { pulseWidthX = centerServoX; pulseWidthY = centerServoY;}\n\n      \u003cspan class=\"hljs-comment\"\u003e// move hard left\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'f'\u003c/span\u003e) {pulseWidthX = minPulseX; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// move hard right\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'h'\u003c/span\u003e) {pulseWidthX = maxPulseX; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// move hard up\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e't'\u003c/span\u003e) {pulseWidthY = minPulseY; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// move hard down\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'g'\u003c/span\u003e) {pulseWidthY = maxPulseY; }\n\n      \u003cspan class=\"hljs-comment\"\u003e// toggle the laser\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (moveServo == \u003cspan class=\"hljs-string\"\u003e'l'\u003c/span\u003e)\n      {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (laseron == \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) { digitalWrite(laserpin, HIGH); laseron = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e; }\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (laseron == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) { digitalWrite(laserpin, LOW); laseron = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; }\n      }\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// however if party mode is enabled\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//else if (partymode == 1)\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//{\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// do some awesome stuff (not yet implemented)\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//  Serial.print(\"Party!!! \");\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//}\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// party mode\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//else if (moveServo == 'p')\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//{\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//  if (partymode == 0) { partymode = 1; }\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//  else if (partymode == 1) { partymode = 0; }\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e//}\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// stop servo pulse at min and max\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pulseWidthX \u003e maxPulseX) { pulseWidthX = maxPulseX; }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pulseWidthX \u0026#x3C; minPulseX) { pulseWidthX = minPulseX; }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pulseWidthY \u003e maxPulseY) { pulseWidthY = maxPulseY; }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pulseWidthY \u0026#x3C; minPulseY) { pulseWidthY = minPulseY; }\n\n  \u003cspan class=\"hljs-comment\"\u003e// print pulseWidth back to the Serial Monitor (uncomment to debug)\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// Serial.print(\"Pulse Width: \");\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// Serial.print(pulseWidth);\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// Serial.println(\"us\");   // microseconds\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// pulse the servo every 20 ms (refreshTime) with current pulseWidth\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// this will hold the servo's position if unchanged, or move it if changed\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (millis() - lastPulse \u003e= refreshTime)\n  {\n    EEPROMWriteInt(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, pulseWidthX);\n    EEPROMWriteInt(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, pulseWidthY);\n\n    digitalWrite(servoPinX, HIGH);   \u003cspan class=\"hljs-comment\"\u003e// start the pulse\u003c/span\u003e\n    delayMicroseconds(pulseWidthX);  \u003cspan class=\"hljs-comment\"\u003e// pulse width\u003c/span\u003e\n    digitalWrite(servoPinX, LOW);    \u003cspan class=\"hljs-comment\"\u003e// end the pulse\u003c/span\u003e\n\n    digitalWrite(servoPinY, HIGH);   \u003cspan class=\"hljs-comment\"\u003e// start the pulse for servo 2\u003c/span\u003e\n    delayMicroseconds(pulseWidthY);  \u003cspan class=\"hljs-comment\"\u003e// pulse width\u003c/span\u003e\n    digitalWrite(servoPinY, LOW);    \u003cspan class=\"hljs-comment\"\u003e// stop the pulse\u003c/span\u003e\n\n    lastPulse = millis();            \u003cspan class=\"hljs-comment\"\u003e// save the time of the last pulse\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eEstablishing Serial Communication\u003c/h3\u003e\n\u003cp\u003eIf you load the above code into the Arduino's IDE and flash it to your microcontroller, you end up with a nice, intuitive way of manually controlling your pan / tilt mechanism. You can try things out by opening the Serial Monitor in the Arduino IDE and moving around using WASD, or move to the extremes using TFGH. Pressing 'C' centers the camera back and 'L' \u003ca href=\"http://spf.fotolog.com/photo/47/10/95/vanguardista2104/1211331863_f.jpg\"\u003efires the laser\u003c/a\u003e. Arguably, you could stop here and technically still have a way of controlling the camera over the internet with the power of linux. All one would need to do is open up a terminal or ssh into the machine and run the following command:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ~$ screen /dev/ttyUSB0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis was not good enough for me though, as I wanted to control this through a web browser, which brings us to...\u003c/p\u003e\n\u003ch3\u003eThe Web Server\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"/2010-09-29-windows-based-webcam-control-software/2010-02-08-193241-150x150.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThe Arduino is cool and all, but since the ultimate goal of this project is to control it over the internet, having a web server is an obvious requirement. Unfortunately for me, my web server also happens to be my self-built desktop that I use for almost all my other engineering work and day to day activities. Because of this, I need access to few windows only applications (Solidworks, LabVIEW, Photoshop, Steam, etc..) which rules out any linux server platforms if I want 100% uptime. This is an unfortunate constraint that caused me quite a lot of headaches down the line. In the future when I have another computer to spare and improve on this project, I will use the \u003ca href=\"http://blog.taragana.com/wp-content/uploads/2008/03/linux-logo.jpg\"\u003eright tool\u003c/a\u003e for the job.\u003c/p\u003e\n\u003cp\u003eAfter all that rambling, you're probably wondering how I have my web server configured. The only relevant details are that I am running stock \u003ca href=\"http://www.wampserver.com/en/\"\u003eWampServer\u003c/a\u003e with PHP 5.3.0 with short tags enabled.\u003c/p\u003e\n\u003ch3\u003eNightmare in PHP land\u003c/h3\u003e\n\u003cp\u003eI thought this would be easy. Since PHP is a server side scripting language, it has libraries that allow it to read and write to and from serial ports. So one would think that something like the following would work:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003e\u003cspan class=\"hljs-variable\"\u003e$fp\u003c/span\u003e =\u003cspan class=\"hljs-title function_ invoke__\"\u003efopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"COM3\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"w\"\u003c/span\u003e);\n\u003cspan class=\"hljs-title function_ invoke__\"\u003efwrite\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$fp\u003c/span\u003e, \u003cspan class=\"hljs-title function_ invoke__\"\u003echr\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'c'\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e// write your character to the Arduino here\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ invoke__\"\u003esleep\u003c/span\u003e(1);\n\u003cspan class=\"hljs-title function_ invoke__\"\u003efclose\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$fp\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, for reasons I do not completely understand, this did not work for me under Windows 7, but it did with Linux (substituting COM3 for /dev/ttyUSB0). This problem persisted, as I also tried using the \u003ca href=\"http://www.phpclasses.org/browse/package/3679.html\"\u003ePHP serial class\u003c/a\u003e, but it too proved to be equally as ineffective. I finally circumvented the need for PHP to communicate with the COM port entirely by compiling several very basic exe's in \u003ca href=\"http://processing.org/\"\u003eprocessing\u003c/a\u003e that sent individual character commands to the Arduino and then called them in PHP using the exec() function.\u003c/p\u003e\n\u003cp\u003eWhile extremely inefficient, this was the quickest, most reliable solution to my problem. Of course, this would all have been avoided in the first place had I been using Linux, as PHP has no problem writing to /dev/ttyUSB0 like it would a normal file in Linux.\u003c/p\u003e\n\u003ch3\u003eBuilding the Webpage\u003c/h3\u003e\n\u003cp\u003eBy accessing the \u003ca href=\"http://www.w3schools.com/PHP/php_get.asp\"\u003ePHP $_GET\u003c/a\u003e array, I was able to map incoming GET requests to different URLS to control what commands were sent to the camera. The PHP included in the header of the page is shown here:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003e\u003cspan class=\"hljs-comment\"\u003e// check the GET action var to see if an action is to be performed\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003eisset\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$_GET\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'action'\u003c/span\u003e]))\n{\n   \u003cspan class=\"hljs-comment\"\u003e// action required! build our command...\u003c/span\u003e\n   \u003cspan class=\"hljs-variable\"\u003e$basecmd\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"F:\\\\wamp\\\\www\\\\luke\\\\Projects\\\\personal_robot\\\\personal robot\\\\commands\\\\\"\u003c/span\u003e;\n   \u003cspan class=\"hljs-variable\"\u003e$cmd\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$basecmd\u003c/span\u003e . \u003cspan class=\"hljs-variable\"\u003e$_GET\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'action'\u003c/span\u003e] . \u003cspan class=\"hljs-string\"\u003e\"\\\\application.windows\\\\\"\u003c/span\u003e . \u003cspan class=\"hljs-variable\"\u003e$_GET\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'action'\u003c/span\u003e] . \u003cspan class=\"hljs-string\"\u003e\".exe\"\u003c/span\u003e;\n   \u003cspan class=\"hljs-title function_ invoke__\"\u003eexec\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$cmd\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd the HTML for the rest of the page is simply a 3x3 table with some hyperlinks to the right URLs with things like \u003ccode\u003e?action=up\u003c/code\u003e, \u003ccode\u003e?action=down\u003c/code\u003e, ect. placed in the right spot.\u003c/p\u003e\n\u003ch3\u003eWebcam\u003c/h3\u003e\n\u003cp\u003eTo manage the webcam feed, I am using a program called \u003ca href=\"http://www.lundie.ca/fwink/\"\u003eFwink\u003c/a\u003e to take a picture every second and then using AJAX to automatically refresh the image once the page is loaded. However, there are many ways to manage a webcam feed and the details of how you do it is out of the scope of what I'm talking about here.\u003c/p\u003e\n\u003ch2\u003eConclusions and Future Improvements\u003c/h2\u003e\n\u003cp\u003eAs expected, performance with this setup is less than impressive, but this was more a learning exercise than it was a perfect execution. I have no doubts in my mind that the low performance is due to the wonky way in which I have to execute system calls to run the Processing exes. For the future, as this is a rough prototype, a lot can be improved / simplified by moving to Linux.\u003c/p\u003e\n\u003cp\u003eAdditionally, this is the vision component to my yet-to-be-completed personal robot, and its brains (a first generation ASUS eeepc netbook) are currently on loan to a friend of mine. Next time I see him I'll get the machine back and we'll start cooking with gas! (and by gas I mean Linux).\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center min-h-screen p-6 pt-0 \",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center mt-6 mb-2 md:mb-8 md:flex-row md:items-center md:justify-start\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-4 md:mb-0 md:mr-4 flex justify-center\",\"children\":[\"$\",\"$L9\",null,{\"src\":\"/icon.png\",\"alt\":\"Logo\",\"width\":100,\"height\":100,\"priority\":true}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center md:items-start\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-6xl font-serif mb-2\",\"children\":\"Stonelinks\"}],[\"$\",\"ul\",null,{\"className\":\"flex list-none gap-4\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/posts\",\"children\":\"Posts\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"About\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"max-w-3xl\",\"children\":[[\"$\",\"article\",null,{\"className\":\"p-5\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Windows Based Webcam Control Software\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500 mt-0 mb-4\",\"children\":\"September 29, 2010\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2 mb-6\",\"children\":[[\"$\",\"$La\",\"0\",{\"className\":\"bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5\",\"href\":\"/tags/systems\",\"children\":\"systems\"}],[\"$\",\"$La\",\"1\",{\"className\":\"bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5\",\"href\":\"/tags/arduino\",\"children\":\"arduino\"}],[\"$\",\"$La\",\"2\",{\"className\":\"bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5\",\"href\":\"/tags/telemetry\",\"children\":\"telemetry\"}]]}],[\"$\",\"img\",null,{\"className\":\"mb-6\",\"src\":\"/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg\",\"alt\":\"Windows Based Webcam Control Software\"}],\"$undefined\",[\"$\",\"div\",null,{\"className\":\"prose max-w-none mt-4\",\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}],[\"$\",\"footer\",null,{\"children\":[[\"$\",\"hr\",null,{\"className\":\"py-4\"}],\"© \",[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"Lucas Doyle\"}],\" \",2025]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"name\":\"theme-color\",\"content\":\"#ffffff\"}],[\"$\",\"meta\",\"2\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"3\",{\"children\":\"Windows Based Webcam Control Software - Lucas Doyle - Personal Website | Stonelinks\"}],[\"$\",\"meta\",\"4\",{\"name\":\"description\",\"content\":\"Read this post by Lucas Doyle\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Windows Based Webcam Control Software\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Read this post by Lucas Doyle\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:title\",\"content\":\"Windows Based Webcam Control Software\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:description\",\"content\":\"Read this post by Lucas Doyle\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/2010-09-29-windows-based-webcam-control-software/2010-02-08-193359-150x150.jpg\"}],[\"$\",\"link\",\"12\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n4:null\n"])</script></body></html>