<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=5.0"/><title>Dr. Serverlove, or How I Learned to Stop Worrying and Love the RAID | Stonelinks</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font-size:112.5%;line-height:1.61em;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:400;word-wrap:break-word;}img{max-width:100%;margin:0;padding:0;margin-bottom:1.61rem;}h1{margin:0;padding:0;margin-bottom:1.61rem;color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:2.415rem;}h2{margin:0;padding:0;margin-bottom:1.61rem;color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.7411rem;line-height:2.415rem;}h3{margin:0;padding:0;margin-bottom:1.61rem;color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:2.415rem;}h4{margin:0;padding:0;margin-bottom:1.61rem;color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.61rem;}h5{margin:0;padding:0;margin-bottom:1.61rem;color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.1487rem;line-height:1.61rem;}h6{margin:0;padding:0;margin-bottom:1.61rem;color:hsl(0,0%,20%);font-family:Lato,sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.61rem;}hgroup{margin:0;padding:0;margin-bottom:1.61rem;}ul{margin:0;padding:0;margin-bottom:1.61rem;list-style-position:outside;list-style-image:none;margin-left:1.61rem;}ol{margin:0;padding:0;margin-bottom:1.61rem;list-style-position:outside;list-style-image:none;margin-left:1.61rem;}dl{margin:0;padding:0;margin-bottom:1.61rem;}dd{margin:0;padding:0;margin-bottom:1.61rem;}p{margin:0;padding:0;margin-bottom:1.61rem;}figure{margin:0;padding:0;margin-bottom:1.61rem;}pre{margin:0;padding:0;margin-bottom:1.61rem;font-size:0.85rem;line-height:1.61rem;}table{margin:0;padding:0;margin-bottom:1.61rem;font-size:1rem;line-height:1.61rem;border-collapse:collapse;width:100%;}fieldset{margin:0;padding:0;margin-bottom:1.61rem;}blockquote{margin:0;padding:0;margin-bottom:1.61rem;margin-right:1.61rem;margin-left:1.61rem;}form{margin:0;padding:0;margin-bottom:1.61rem;}noscript{margin:0;padding:0;margin-bottom:1.61rem;}iframe{margin:0;padding:0;margin-bottom:1.61rem;}hr{margin:0;padding:0;margin-bottom:calc(1.61rem - 1px);background:hsl(0,0%,80%);border:none;height:1px;}address{margin:0;padding:0;margin-bottom:1.61rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.61rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.61rem;margin-bottom:calc(1.61rem / 2);margin-top:calc(1.61rem / 2);}li > ul{margin-left:1.61rem;margin-bottom:calc(1.61rem / 2);margin-top:calc(1.61rem / 2);}code{font-size:0.85rem;line-height:1.61rem;}kbd{font-size:0.85rem;line-height:1.61rem;}samp{font-size:0.85rem;line-height:1.61rem;}abbr{border-bottom:1px dotted hsl(0,0%,50%);cursor:help;}acronym{border-bottom:1px dotted hsl(0,0%,50%);cursor:help;}abbr[title]{border-bottom:1px dotted hsl(0,0%,50%);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsl(0,0%,88%);padding-left:1.07333rem;padding-right:1.07333rem;padding-top:0.805rem;padding-bottom:calc(0.805rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}@media only screen and (max-width:768px){h1{font-size:2rem;line-height:2.415rem;}h2{font-size:1.7411rem;line-height:2.415rem;}h3{font-size:1.51572rem;line-height:2.415rem;}h4{font-size:1.31951rem;line-height:1.61rem;}h5{font-size:1.1487rem;line-height:1.61rem;}h6{font-size:1rem;line-height:1.61rem;}}</style><link href="//fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css"/></head><body><div id="react-mount"><div style="max-width:41.86rem;margin-left:auto;margin-right:auto;padding:1.2075rem;" data-reactroot="" data-reactid="1" data-react-checksum="2079117732"><header style="margin-bottom:1.61rem;" data-reactid="2"><div data-reactid="3"><h3 style="margin-top:0;margin-bottom:0;font-size:1.51572rem;line-height:2.415rem;" data-reactid="4"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/" data-reactid="5"><img src="/icon.png" style="margin:0;margin-top:-4px;border:0;width:35px;height:35px;vertical-align:middle;" data-reactid="6"/><!-- react-text: 7 --> <!-- /react-text --><!-- react-text: 8 -->Stonelinks<!-- /react-text --></a></h3></div><hr style="margin-top:0.805rem;margin-bottom:0.805rem;background-color:gray;" data-reactid="9"/><span data-reactid="10"><a href="/" data-reactid="11">Home</a><!-- react-text: 12 --> | <!-- /react-text --><a href="/posts/" data-reactid="13">Posts</a><!-- react-text: 14 --> | <!-- /react-text --><a href="/projects/" data-reactid="15">Projects</a><!-- react-text: 16 --> | <!-- /react-text --><a href="/about/" data-reactid="17">About</a></span></header><div class="markdown" data-reactid="18"><div data-reactid="19"><h1 style="margin-top:0;margin-bottom:0.4025rem;" data-reactid="20">Dr. Serverlove, or How I Learned to Stop Worrying and Love the RAID</h1><div style="margin-top:0.4025rem;margin-bottom:0.805rem;font-size:0.805rem;color:gray;" data-reactid="21">12/06/2010</div></div><div class="article" data-reactid="22"><p>I recently completed some much needed upgrades to the servers (hardware and software) that run Stonelinks. This has me very excited and has been a long time in the works! Warning: long and somewhat pointless story of blood, sweat, nerdrage and glorious payoff ahead.</p>
<p><img src="/posts/dr-serverlove-or-how-i-learned-to-stop-worrying-and-love-the-raid/downsize-300x225.jpg" alt=""></p>
<p>These two suckers now live on my desk and throw off a ton of heat.</p>
<p>Despite being a humongous Linux nerd, for years I have hosted Stonelinks using Windows / <a href="http://www.wampserver.com/en/">WAMP</a> server (which is the same thing as LAMP, just replace Linux with Windows). For a long time this was my only option as far as “free” hosting using RPI’s bandwidth, as my desktop is the only computer I own that is consistently on 24/7 and can function in a server role.</p>
<p>By necessity, my desktop needs to be running Windows 7 because unfortunately I need access to a bunch of programs that I can’t get or don’t exist for Linux. Things like LabVIEW for work at the <a href="/projects/amf/">Harvard-Smithsonain Center for Astrophysics</a>, MATLAB so my room mate can run his week-long computational fluid dynamic simulations on for his research (we need our own supercomputer for this!), Solidworks for random CAD I occasionally do, Netflix because content licensing people are afraid of Linux and finally Team Fortress 2 because I occasionally like to get my game on. Because of the sporadic nature of when I use most of these programs, it also means that dual booting between Linux and Windows is of the question since that doesn’t guarantee uptime. I didn’t want to shut down the server while someone was using it just so I could boot into Windows and do some CAD.</p>
<p>Therefore, I have stuck with my WAMP setup for many years. As far as WAMP is concerned, it has sort of been “fine” most of the time, but definitely not ideal. All of the other websites I work on are hosted from some flavor of Linux. It is free, extremely stable, makes administration and development a breeze compared to Windows (what a nightmare it was to get PHP’s <code>mail()</code> command to work with SSL in Windows), the list goes on.</p>
<p>Hosting Stonelinks under Linux has been a goal/dream of mine for awhile now. Occasionally I would try using a virtual machine to host, but I’d always find that to be too resource intensive and would BSOD windows after awhile if left on for too long. Cygwin was and always has been a nightmare for me too, so I didn’t even go there. Interestingly, I did have some success with something called <a href="http://www.andlinux.org/">andLinux</a> which, by my understanding, is an Ubuntu installation based around a Linux kernel compiled to use win32 system calls a la <a href="http://www.colinux.org/">coLinux</a>. All the benefits of a virtual machine without the instability and losing a massive chunk of RAM. I ultimately dumped andLinux, mostly because andLinux uses a virtual network adapter to communicate with Windows. A webserver running under andLinux would be heavily bandwidth constrained for any clients other than localhost. So up until writing this I’ve been really, throughly stuck.</p>
<p>Fast forward to a few weeks before Christmas. For an early Christmas present, I decided to replace my Dad’s aging Dell with a Newegg special custom desktop. I built him a pretty sweet machine, and even got him using Ubuntu (quite the tech-savvy 63 year old!), with a Windows XP virtual machine to fall back on if he ever gets really stuck with something. This left his old desktop vacated for me to use!</p>
<p>The Dell made it’s glorious pilgrimage to RPI with me where I proceeded to wipe it’s brains and installed the latest Ubuntu on it. I then began the task of porting Stonelinks over to that machine. One problem though: my Dad’s old Dell did not have enough disk space for it.</p>
<p>Queue my second Newegg purchase: I bought two 2-TB SATA disks and a RAID card (among other things) on cyber Monday for the crazy price of $180 (granted the RAID card is not a “real” RAID card, as none of the parity checking for RAID is done by hardware on the card it is basically a glorified SATA controller). I wrongfully assumed that since the RAID card was PCI, it would be compatible with the old Dell. I thought that since there were no SATA ports on the motherboard of the Dell I could use the RAID card to be the root of the webserver. At the very worst, I knew the firmware on the card was swappable so I could re-flash firmware on the card to make it act as a pass through (no RAID whatsoever) for the drives to the OS. Booooy was I wrong.</p>
<p>First of all, the RAID controller was not being picked up, not even in the BIOS, on the Dell. No matter what I tried, it wouldn’t work in the Dell (and yes I had the Linux drivers for it / proper kernel modules running). I thought I might have a defective card so I tried it in a spare PCI slot on my desktop. The card worked like a charm! At this point I was tearing my hair out – Something on the Dell’s motherboard was incompatible with the RAID card? I didn’t even care about RAID at this point, I just wanted SATA drives to work on the Dell at which point I could use something like <a href="http://en.wikipedia.org/wiki/Mdadm">mdadm</a> for fake RAID. I thought that flashing the firmware that makes the card act like a pass through was a good idea. This opened up a new can of nightmares for me!</p>
<p>Turns out that Silicon Image (SI from here on out), the maker of the “fake” RAID controller chip on the card I bought, supplies its chips / firmware to 3rd parties that put together the cards and sell them. In order to even begin messing with the firmware on the card I had to use a bunch of really bad DOS executables that I called from the command line, and then had to echo the return value (took me forever to figure out how to do… damn windows shell) so I could match the number up with the response code on some PDF off their website and figure out what was wrong. At this point I am furious that I’ve wasted so much time on this. Using the sinfully awful SI tools, I eventually figured out that my card manufacturer, Rosewill, was storing the device firmware on an external flash chip that I could not flash with any different firmware.</p>
<p>At this point I have not slept in probably 24 hours and am feeling like I want to skewer the card on my African war sword (yes I own one of these) throw it in the oven, set it to self clean and walk away. Alas, I am too stubborn to give up like that though, so I cook up what became my final solution to hosting this iteration of Stonelinks.</p>
<p>Essentially, I separated content between the two servers by keeping the RAID array on my main desktop, sharing it as a Windows share, and then using <a href="https://help.ubuntu.com/community/Autofs">autofs</a> to mount the share on the Dell / Ubuntu and serve it. Both machines live behind the same 10/100 switch and I can pull data off there at fairly high speeds, so I was happy! The hardest part about getting this to work was managing permissions between the two machines and finding a good way to keep track of my Desktop because its IP was no longer static. I accomplished the former by being a clever chmod user, and the latter with dynamic DNS. Overall, I’d say the lessons I learned from this were things I already knew but were or sure reinforced:</p>
<ul>
<li>Don’t buy something (RAID card in this case) just because it is cheap.</li>
<li>Don’t make assumptions about how something will work, do your research.</li>
<li>Instead of trying solve a complicated problem all at once and banging your head against the wall, walk away from it. When you come back and attack it bit by bit, you’re more likely to have more energy and better insight.</li>
</ul>
</div><div data-reactid="23"><div style="margin-bottom:0.805rem;font-size:0.805rem;color:gray;" data-reactid="24"><span data-reactid="25"><!-- react-text: 26 -->Tags: <!-- /react-text --><a href="/tags/#web-development" data-reactid="27">Web development</a></span></div><hr style="background-color:gray;" data-reactid="28"/><div data-reactid="29"><h6 style="margin:0;font-size:0.70711rem;line-height:1.61rem;color:gray;" data-reactid="30">Read this next:</h6><h3 style="margin-top:0;margin-bottom:0.4025rem;" data-reactid="31"><a href="/posts/new-webgl-projects/" data-reactid="32"><!-- react-text: 33 --> <!-- /react-text --><!-- react-text: 34 -->New WebGL Projects<!-- /react-text --><!-- react-text: 35 --> <!-- /react-text --></a></h3><div data-reactid="36">I’ve been working on some new WebGL related projects for a 3d viewer and editor that targets robotics applications.
<a href="https://github.com/Stonelinks/three.js">My three.js fork</a>
All these...</div><hr style="margin-top:1.61rem;background-color:gray;" data-reactid="37"/></div><p style="margin-bottom:1.61rem;" data-reactid="38"><a href="/about/" data-reactid="39"><img src="/author.png" alt="Lucas Doyle" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4025rem;width:3.22rem;height:3.22rem;border-radius:50%;border:1px gray solid;" data-reactid="40"/></a><span data-reactid="41"><!-- react-text: 42 -->Written by <!-- /react-text --><a href="/about/" data-reactid="43">Lucas Doyle</a><!-- react-text: 44 -->, a robotics engineer who does a lot of web development in San Francisco.<!-- /react-text --></span></p></div></div><span style="display:block;clear:both;" data-reactid="45"> </span></div></div><script src="/bundle.js?t=1479194401725"></script></body></html>