<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/icon.png" fetchPriority="high"/><link rel="stylesheet" href="/_next/static/css/e12fb8457429c492.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7a6e15ce7603e944.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-06eb45215460ab53.js"/><script src="/_next/static/chunks/fd9d1056-be48aeae6e94b8d1.js" async=""></script><script src="/_next/static/chunks/23-093443f120d56e9e.js" async=""></script><script src="/_next/static/chunks/main-app-f67fffbe34eb65ac.js" async=""></script><script src="/_next/static/chunks/994-e0384b19511b091b.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-c6567c6c1ae134f3.js" async=""></script><meta name="theme-color" content="#ffffff"/><title>Laser Altimeter Integration on Pixhawk - Lucas Doyle - Personal Website | Stonelinks</title><meta name="description" content="Read this post by Lucas Doyle"/><meta property="og:title" content="Laser Altimeter Integration on Pixhawk"/><meta property="og:description" content="Read this post by Lucas Doyle"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Laser Altimeter Integration on Pixhawk"/><meta name="twitter:description" content="Read this post by Lucas Doyle"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><div class="flex flex-col justify-between items-center min-h-screen p-6 pt-0 "><div class="flex flex-col items-center mt-6 mb-2 md:mb-8 md:flex-row md:items-center md:justify-start"><div class="mb-4 md:mb-0 md:mr-4 flex justify-center"><img alt="Logo" fetchPriority="high" width="100" height="100" decoding="async" data-nimg="1" style="color:transparent" src="/icon.png"/></div><div class="flex flex-col items-center md:items-start"><h1 class="text-4xl md:text-6xl font-serif mb-2">Stonelinks</h1><ul class="flex list-none gap-4"><li><a href="/">Home</a></li><li><a href="/posts/">Posts</a></li><li><a href="/projects/">Projects</a></li><li><a href="/luke/">About</a></li></ul></div></div><div class="max-w-3xl"><article class="p-5"><h1>Laser Altimeter Integration on Pixhawk</h1><p class="text-sm text-gray-500 mt-0 mb-4">December 10, 2014</p><div class="flex flex-wrap gap-2 mb-6"><a class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5" href="/tags/airplane/">airplane</a><a class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5" href="/tags/drones/">drones</a></div><div class="prose max-w-none mt-4"><p>As some of you may know, I have left Tokyo and the world of industrial robotics and am now in the midst of immersing myself in the world of drones in San Francisco. Its a very exciting time in my life! Among other things, I did some research into the different drone platforms out there.</p>
<p>As a sample exercise, I took an in-depth look at how I'd go about integrating a laser altimeter on to the 3DR Pixhawk.</p>
<h2>Step 0: Source a sensor</h2>
<p>All signs of googling point to the <a href="http://www.lightware.co.za/shop/en/lrf-modules/7-sf02f.html">SF02/F laser altimeter</a> as the quickest option to get something working.</p>
<p><img src="/2014-12-10-laser-altimeter-integration/rangefinder_sf02_pixhawk_connections.jpg" alt=""></p>
<p><strong>Specs</strong>:</p>
<ul>
<li><strong>Manufacturer</strong>: A South African company called <a href="http://www.lightware.co.za/shop/en/">lightware</a></li>
<li><strong>Weight</strong>: 69 g</li>
<li><strong>Range</strong>: 0-40 m</li>
<li><strong>Resolution</strong>: 1 cm</li>
<li><strong>Price and availability</strong>: $300 each, currently on backorder!</li>
<li><strong>Update rate</strong>: 12 hz</li>
<li><strong>Outputs &#x26; interfaces</strong>: Analog, serial and digital</li>
<li><strong>Power supply voltage</strong>: 6.5-9.0 V or 5.0 V Â± 0.5 V DC</li>
<li><strong>Power supply current</strong>: 150 mA (maximum)</li>
<li><strong>Dimensions</strong>: 27 x 59 x 86 mm</li>
</ul>
<p><strong>Pros</strong>:</p>
<ul>
<li>Good <a href="https://pixhawk.org/platforms/planes/phantom_fpv_flying_wing#px4_fmu_build_log">example applications</a> on UAVs using Pixhawk already out there.</li>
<li><a href="https://pixhawk.org/peripherals/rangefinder">Documentation</a> on how to interface and a <a href="https://github.com/PX4/Firmware/tree/master/src/drivers/sf0x">Pixhawk driver</a> already exists.</li>
<li>It is a high quality piece of equipment. This guy gave it <a href="http://diydrones.com/profiles/blogs/sf02-laser-altimeter-review">a unbiased, positive review</a>.</li>
<li>Manufacturer includes <a href="http://www.lightware.co.za/shop/en/content/8-software">software</a> that can be used to test the sensor independently from the Pixhawk.</li>
<li>Good activity and info from the <a href="http://diydrones.com/profile/LaserDeveloper">manufacturer's DIY drones account</a>. Seem to help people with their problems and provide good feedback.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>The 40 m range is likely too short for any application other than automated landings. 40 m is fine for landings since those obviously occur close to the ground. However if you're using the rangefinder for data acquisition the entire flight, then 40 m is too short. <a href="http://diydrones.com/forum/topics/looking-for-new-technology-1?commentId=705844%3AComment%3A1761627&#x26;xg_source=activity">Supposedly the company is developing another similar sensor</a> with a longer range.</li>
<li>Expensive! At $300 a pop, equipping a fleet of drones with these will be pricey.</li>
<li>Looks like the manufacturer is making these only for the hobbyist market. This means that they may make them in bulk, they might not be made to high industrial standards or that there it could be suddenly discontinued if they decide the hobbyist market isn't worth it.</li>
</ul>
<p><strong>Alternatives</strong>:</p>
<p>To address some of the SF02's cons (and given that we're equipping a fleet), I looked for an alternate sensor on <a href="http://www.alibaba.com/">Alibaba</a>. If you're not familiar with Alibaba, it is basically a way to buy wholesale electronics / components / sub-assemblies directly from Chinese suppliers. The best option I found for a laser rangefinder module is <a href="http://www.alibaba.com/product-detail/rangefinder-module_713054756.html">this sensor</a>. It is $100 - $300, so potentially a third of the cost per unit compared to the SF02, which is a massive savings. The range is also much better (says 10 - 800 m). Details on power consumption and how to interface with it are not clear, but I'm sure talking with the manufacturer (which is easy on Alibaba) would clear that up. Finally, the stated minimum distance (10 m) and accuracy (1 m vs. the SF02's 1 cm) is pretty bad and won't be useful for landings.</p>
<p><a href="http://www.dragoninnovation.com/projects/32-lidar-lite-by-pulsedlight">This sensor is intriguing</a> but not yet available. Good to keep an eye on, especially since <a href="https://store.3drobotics.com/products/lidar-lite/">3DR seems to be supporting it</a>. Far cheaper and smaller but still only a 40 m range.</p>
<p>So while these other sensors may potentially work, for the sake of this analysis I'm going to with the SF02.</p>
<h2>Step 1: Connect to the Pixhawk</h2>
<p>The wiring from the SF02 to the Pixhawk goes like this:</p>
<table>
<thead>
<tr>
<th>Pixhawk <span class="caps">UART</span> pin</th>
<th><span class="caps">SF02</span>/F pin</th>
<th>Comment </th>
</tr>
</thead>
<tbody>
<tr>
<td> 1 / +5V</td>
<td>3 / +5V</td>
<td>Power supply </td>
</tr>
<tr>
<td> 2 / <span class="caps">TX</span></td>
<td>9 / <span class="caps">RX</span></td>
<td>3.3V <span class="caps">UART</span> <span class="caps">SF02</span>/F receive </td>
</tr>
<tr>
<td> 3 / <span class="caps">RX</span></td>
<td>8 / <span class="caps">TX</span></td>
<td>3.3V <span class="caps">UART</span> <span class="caps">SF02</span>/F transmit </td>
</tr>
<tr>
<td> 6 / <span class="caps">GND</span></td>
<td>2 / -</td>
<td>Ground </td>
</tr>
</tbody>
</table>
<p>Since the SF02 uses screw terminals, depending on how much the aircraft vibrates it may be a good idea to soldier up the leads to the screw terminal. This is the <a href="https://store.3drobotics.com/products/df13-6-position-connector-45-cm">cable / connector</a> you'd use. Plug the SF02 into TELEM2 of the Pixhawk.</p>
<h2>Step 2: Install on the aircraft</h2>
<p>You'll want to put the sensor pointing at the ground obviously, keeping it perpendicular to the aircraft. The sensor should also be mounted in a recessed position so that the optics arn't scratched during a rough landing. Also, it should be positioned such that it doesn't mess with the center of gravity for the aircraft otherwise it will affect glide characteristics.</p>
<h2>Step 3: Software</h2>
<p><strong>Drivers</strong></p>
<p>The <a href="https://github.com/PX4/Firmware/tree/master/src/drivers/sf0x">sf0x driver</a> needed for the Pixhawk is already part of the firmware. To start the driver:</p>
<p><strong>Drivers</strong></p>
<p>The <a href="https://github.com/PX4/Firmware/tree/master/src/drivers/sf0x">sf0x driver</a> needed for the Pixhawk is already part of the firmware. To start the driver:</p>
<pre><code class="hljs language-bash">sf0x start
</code></pre>
<p>And to run a test and verify the sensor is working:</p>
<pre><code class="hljs language-bash">sf0x <span class="hljs-built_in">test</span>
</code></pre>
<p>Add a file called <code>etc/extras.txt</code> to your microSD card with this content to autostart the driver:</p>
<pre><code class="hljs language-bash">sf0x start
</code></pre>
<p><strong>Receiving sensor data in your PX4 application</strong></p>
<p>PX4 has some great hardware abstraction, so we don't have to directly interact with the driver at all. Instead, we <a href="http://pixhawk.org/dev/px4_simple_app#step_5subscribing_sensor_data">subscribe to inter-process messages</a> published by the sensor driver. In order to get data from the laser rangefinder, we need to subscribe to the topic that it publishes on. <a href="http://pixhawk.org/dev/shared_object_communication">This</a> is a good resource on how to do that. Looking at the source for the <code>sf0x</code> driver, we need to subscribe to the <code>sensor_range_finder</code> topic which comes from <a href="https://github.com/PX4/Firmware/blob/master/src/drivers/drv_range_finder.h"><code>drivers/drv_range_finder.h</code></a>. So in our application we'd subscribe like this:</p>
<pre><code class="hljs language-c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;drivers/drv_range_finder.h></span></span>
..
<span class="hljs-type">int</span> rangefinder_sub_fd = orb_subscribe(ORB_ID(sensor_range_finder));
</code></pre>
<p>To actually get data out of the subscriber, we need to use the <code>poll()</code> POSIX system call. This approach will sleep the thread (consuming no CPU cycles) until data from the sensor actually gets published. We achieve this like so:</p>
<pre><code class="hljs language-c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;poll.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;drivers/drv_range_finder.h></span></span>
..
<span class="hljs-type">int</span> rangefinder_sub_fd = orb_subscribe(ORB_ID(sensor_range_finder));

<span class="hljs-comment">/* one could wait for multiple topics with this technique, just using one here */</span>

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> <span class="hljs-title">fds</span>[] =</span> {
  { .fd = rangefinder_sub_fd,   .events = POLLIN },
};

<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {

  <span class="hljs-comment">/* wait for sensor update of 1 file descriptor for 1000 ms (1 second) */</span>

  <span class="hljs-type">int</span> poll_ret = poll(fds, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>);
  <span class="hljs-keyword">if</span> (fds[<span class="hljs-number">0</span>].revents &#x26; POLLIN) {

    <span class="hljs-comment">/* obtained data for the first file descriptor */</span>

    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">range_finder_report</span> <span class="hljs-title">rangefinder_data</span>;</span>

    <span class="hljs-comment">/* copy rangefinder data into local buffer */</span>

    orb_copy(ORB_ID(sensor_range_finder), rangefinder_sub_fd, &#x26;rangefinder_data);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Rangefinder distance:\t%8.4f\t%8.4f\t%8.4f\n"</span>, (<span class="hljs-type">double</span>)rangefinder_data.distance[<span class="hljs-number">0</span>]);
  }
}
</code></pre>
<h2>Step 4: use it in your application</h2>
<p>The code snippet above isn't a complete application, but you get the idea. Once the range finder data is copied into that <code>range_finder_report</code> struct instance, the sky is the limit (pun intended) for what you want to do to it. This is where higher level, application specific things get implemented. Some things I can think of to do with altimeter data:</p>
<ul>
<li>Log the data, fly the drone fleet in a lawnmower / zig zag pattern to try to cover a large area, and then use it for 3d reconstruction later. To do this you would also need a decent estimate of aircraft position and orientation.</li>
<li>Transmit data to a ground station for similar logging purposes. The ground station could be the central data aggregation point for the fleet. If the ground station has an internet connection, it could run a webserver for others to monitor aircraft data in real time from off-site.</li>
<li>Implement an automated landing routine. Would need to figure out at what speed / altitude you'd need to flare the aircraft right before touchdown.</li>
</ul>
<p>Without knowing any more details about the exact application, I think this is where I'll stop.</p></div></article><footer class="mt-6"><hr/>Â© <a href="/luke/">Lucas Doyle</a> <!-- -->2025</footer></div></div><script src="/_next/static/chunks/webpack-06eb45215460ab53.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/e12fb8457429c492.css\",\"style\"]\n2:HL[\"/_next/static/css/7a6e15ce7603e944.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5751,[],\"\"]\n6:I[9275,[],\"\"]\n8:I[1343,[],\"\"]\n9:I[8173,[\"994\",\"static/chunks/994-e0384b19511b091b.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-c6567c6c1ae134f3.js\"],\"Image\"]\na:I[231,[\"994\",\"static/chunks/994-e0384b19511b091b.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-c6567c6c1ae134f3.js\"],\"\"]\nc:I[6130,[],\"\"]\n7:[\"slug\",\"2014-12-10-laser-altimeter-integration\",\"d\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e12fb8457429c492.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"o63z9xbrVKiAQQjvS3L9z\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2014-12-10-laser-altimeter-integration/\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2014-12-10-laser-altimeter-integration\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"2014-12-10-laser-altimeter-integration\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2014-12-10-laser-altimeter-integration\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",\"$L5\"],null],null]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$7\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7a6e15ce7603e944.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col justify-between items-center min-h-screen p-6 pt-0 \",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center mt-6 mb-2 md:mb-8 md:flex-row md:items-center md:justify-start\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-4 md:mb-0 md:mr-4 flex justify-center\",\"children\":[\"$\",\"$L9\",null,{\"src\":\"/icon.png\",\"alt\":\"Logo\",\"width\":100,\"height\":100,\"priority\":true}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center md:items-start\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-6xl font-serif mb-2\",\"children\":\"Stonelinks\"}],[\"$\",\"ul\",null,{\"className\":\"flex list-none gap-4\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/posts\",\"children\":\"Posts\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"About\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"max-w-3xl\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"404 - Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"mb-4 text-gray-600\",\"children\":\"Sorry, that page does not exist.\"}]],[\"$\",\"footer\",null,{\"className\":\"mt-6\",\"children\":[[\"$\",\"hr\",null,{}],\"Â© \",[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"Lucas Doyle\"}],\" \",2025]}]]}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7a6e15ce7603e944.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],\"styles\":null}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]]\n"])</script><script>self.__next_f.push([1,"e:T2d58,"])</script><script>self.__next_f.push([1,"\u003cp\u003eAs some of you may know, I have left Tokyo and the world of industrial robotics and am now in the midst of immersing myself in the world of drones in San Francisco. Its a very exciting time in my life! Among other things, I did some research into the different drone platforms out there.\u003c/p\u003e\n\u003cp\u003eAs a sample exercise, I took an in-depth look at how I'd go about integrating a laser altimeter on to the 3DR Pixhawk.\u003c/p\u003e\n\u003ch2\u003eStep 0: Source a sensor\u003c/h2\u003e\n\u003cp\u003eAll signs of googling point to the \u003ca href=\"http://www.lightware.co.za/shop/en/lrf-modules/7-sf02f.html\"\u003eSF02/F laser altimeter\u003c/a\u003e as the quickest option to get something working.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/2014-12-10-laser-altimeter-integration/rangefinder_sf02_pixhawk_connections.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSpecs\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eManufacturer\u003c/strong\u003e: A South African company called \u003ca href=\"http://www.lightware.co.za/shop/en/\"\u003elightware\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eWeight\u003c/strong\u003e: 69 g\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRange\u003c/strong\u003e: 0-40 m\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eResolution\u003c/strong\u003e: 1 cm\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePrice and availability\u003c/strong\u003e: $300 each, currently on backorder!\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eUpdate rate\u003c/strong\u003e: 12 hz\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eOutputs \u0026#x26; interfaces\u003c/strong\u003e: Analog, serial and digital\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePower supply voltage\u003c/strong\u003e: 6.5-9.0 V or 5.0 V Â± 0.5 V DC\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePower supply current\u003c/strong\u003e: 150 mA (maximum)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDimensions\u003c/strong\u003e: 27 x 59 x 86 mm\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003ePros\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGood \u003ca href=\"https://pixhawk.org/platforms/planes/phantom_fpv_flying_wing#px4_fmu_build_log\"\u003eexample applications\u003c/a\u003e on UAVs using Pixhawk already out there.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://pixhawk.org/peripherals/rangefinder\"\u003eDocumentation\u003c/a\u003e on how to interface and a \u003ca href=\"https://github.com/PX4/Firmware/tree/master/src/drivers/sf0x\"\u003ePixhawk driver\u003c/a\u003e already exists.\u003c/li\u003e\n\u003cli\u003eIt is a high quality piece of equipment. This guy gave it \u003ca href=\"http://diydrones.com/profiles/blogs/sf02-laser-altimeter-review\"\u003ea unbiased, positive review\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eManufacturer includes \u003ca href=\"http://www.lightware.co.za/shop/en/content/8-software\"\u003esoftware\u003c/a\u003e that can be used to test the sensor independently from the Pixhawk.\u003c/li\u003e\n\u003cli\u003eGood activity and info from the \u003ca href=\"http://diydrones.com/profile/LaserDeveloper\"\u003emanufacturer's DIY drones account\u003c/a\u003e. Seem to help people with their problems and provide good feedback.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eCons\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe 40 m range is likely too short for any application other than automated landings. 40 m is fine for landings since those obviously occur close to the ground. However if you're using the rangefinder for data acquisition the entire flight, then 40 m is too short. \u003ca href=\"http://diydrones.com/forum/topics/looking-for-new-technology-1?commentId=705844%3AComment%3A1761627\u0026#x26;xg_source=activity\"\u003eSupposedly the company is developing another similar sensor\u003c/a\u003e with a longer range.\u003c/li\u003e\n\u003cli\u003eExpensive! At $300 a pop, equipping a fleet of drones with these will be pricey.\u003c/li\u003e\n\u003cli\u003eLooks like the manufacturer is making these only for the hobbyist market. This means that they may make them in bulk, they might not be made to high industrial standards or that there it could be suddenly discontinued if they decide the hobbyist market isn't worth it.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eAlternatives\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003eTo address some of the SF02's cons (and given that we're equipping a fleet), I looked for an alternate sensor on \u003ca href=\"http://www.alibaba.com/\"\u003eAlibaba\u003c/a\u003e. If you're not familiar with Alibaba, it is basically a way to buy wholesale electronics / components / sub-assemblies directly from Chinese suppliers. The best option I found for a laser rangefinder module is \u003ca href=\"http://www.alibaba.com/product-detail/rangefinder-module_713054756.html\"\u003ethis sensor\u003c/a\u003e. It is $100 - $300, so potentially a third of the cost per unit compared to the SF02, which is a massive savings. The range is also much better (says 10 - 800 m). Details on power consumption and how to interface with it are not clear, but I'm sure talking with the manufacturer (which is easy on Alibaba) would clear that up. Finally, the stated minimum distance (10 m) and accuracy (1 m vs. the SF02's 1 cm) is pretty bad and won't be useful for landings.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.dragoninnovation.com/projects/32-lidar-lite-by-pulsedlight\"\u003eThis sensor is intriguing\u003c/a\u003e but not yet available. Good to keep an eye on, especially since \u003ca href=\"https://store.3drobotics.com/products/lidar-lite/\"\u003e3DR seems to be supporting it\u003c/a\u003e. Far cheaper and smaller but still only a 40 m range.\u003c/p\u003e\n\u003cp\u003eSo while these other sensors may potentially work, for the sake of this analysis I'm going to with the SF02.\u003c/p\u003e\n\u003ch2\u003eStep 1: Connect to the Pixhawk\u003c/h2\u003e\n\u003cp\u003eThe wiring from the SF02 to the Pixhawk goes like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ePixhawk \u003cspan class=\"caps\"\u003eUART\u003c/span\u003e pin\u003c/th\u003e\n\u003cth\u003e\u003cspan class=\"caps\"\u003eSF02\u003c/span\u003e/F pin\u003c/th\u003e\n\u003cth\u003eComment \u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e 1 / +5V\u003c/td\u003e\n\u003ctd\u003e3 / +5V\u003c/td\u003e\n\u003ctd\u003ePower supply \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e 2 / \u003cspan class=\"caps\"\u003eTX\u003c/span\u003e\u003c/td\u003e\n\u003ctd\u003e9 / \u003cspan class=\"caps\"\u003eRX\u003c/span\u003e\u003c/td\u003e\n\u003ctd\u003e3.3V \u003cspan class=\"caps\"\u003eUART\u003c/span\u003e \u003cspan class=\"caps\"\u003eSF02\u003c/span\u003e/F receive \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e 3 / \u003cspan class=\"caps\"\u003eRX\u003c/span\u003e\u003c/td\u003e\n\u003ctd\u003e8 / \u003cspan class=\"caps\"\u003eTX\u003c/span\u003e\u003c/td\u003e\n\u003ctd\u003e3.3V \u003cspan class=\"caps\"\u003eUART\u003c/span\u003e \u003cspan class=\"caps\"\u003eSF02\u003c/span\u003e/F transmit \u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e 6 / \u003cspan class=\"caps\"\u003eGND\u003c/span\u003e\u003c/td\u003e\n\u003ctd\u003e2 / -\u003c/td\u003e\n\u003ctd\u003eGround \u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eSince the SF02 uses screw terminals, depending on how much the aircraft vibrates it may be a good idea to soldier up the leads to the screw terminal. This is the \u003ca href=\"https://store.3drobotics.com/products/df13-6-position-connector-45-cm\"\u003ecable / connector\u003c/a\u003e you'd use. Plug the SF02 into TELEM2 of the Pixhawk.\u003c/p\u003e\n\u003ch2\u003eStep 2: Install on the aircraft\u003c/h2\u003e\n\u003cp\u003eYou'll want to put the sensor pointing at the ground obviously, keeping it perpendicular to the aircraft. The sensor should also be mounted in a recessed position so that the optics arn't scratched during a rough landing. Also, it should be positioned such that it doesn't mess with the center of gravity for the aircraft otherwise it will affect glide characteristics.\u003c/p\u003e\n\u003ch2\u003eStep 3: Software\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eDrivers\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ca href=\"https://github.com/PX4/Firmware/tree/master/src/drivers/sf0x\"\u003esf0x driver\u003c/a\u003e needed for the Pixhawk is already part of the firmware. To start the driver:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDrivers\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ca href=\"https://github.com/PX4/Firmware/tree/master/src/drivers/sf0x\"\u003esf0x driver\u003c/a\u003e needed for the Pixhawk is already part of the firmware. To start the driver:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esf0x start\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd to run a test and verify the sensor is working:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esf0x \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAdd a file called \u003ccode\u003eetc/extras.txt\u003c/code\u003e to your microSD card with this content to autostart the driver:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esf0x start\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eReceiving sensor data in your PX4 application\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePX4 has some great hardware abstraction, so we don't have to directly interact with the driver at all. Instead, we \u003ca href=\"http://pixhawk.org/dev/px4_simple_app#step_5subscribing_sensor_data\"\u003esubscribe to inter-process messages\u003c/a\u003e published by the sensor driver. In order to get data from the laser rangefinder, we need to subscribe to the topic that it publishes on. \u003ca href=\"http://pixhawk.org/dev/shared_object_communication\"\u003eThis\u003c/a\u003e is a good resource on how to do that. Looking at the source for the \u003ccode\u003esf0x\u003c/code\u003e driver, we need to subscribe to the \u003ccode\u003esensor_range_finder\u003c/code\u003e topic which comes from \u003ca href=\"https://github.com/PX4/Firmware/blob/master/src/drivers/drv_range_finder.h\"\u003e\u003ccode\u003edrivers/drv_range_finder.h\u003c/code\u003e\u003c/a\u003e. So in our application we'd subscribe like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;drivers/drv_range_finder.h\u003e\u003c/span\u003e\u003c/span\u003e\n..\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e rangefinder_sub_fd = orb_subscribe(ORB_ID(sensor_range_finder));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo actually get data out of the subscriber, we need to use the \u003ccode\u003epoll()\u003c/code\u003e POSIX system call. This approach will sleep the thread (consuming no CPU cycles) until data from the sensor actually gets published. We achieve this like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;poll.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;drivers/drv_range_finder.h\u003e\u003c/span\u003e\u003c/span\u003e\n..\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e rangefinder_sub_fd = orb_subscribe(ORB_ID(sensor_range_finder));\n\n\u003cspan class=\"hljs-comment\"\u003e/* one could wait for multiple topics with this technique, just using one here */\u003c/span\u003e\n\n\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003epollfd\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efds\u003c/span\u003e[] =\u003c/span\u003e {\n  { .fd = rangefinder_sub_fd,   .events = POLLIN },\n};\n\n\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n\n  \u003cspan class=\"hljs-comment\"\u003e/* wait for sensor update of 1 file descriptor for 1000 ms (1 second) */\u003c/span\u003e\n\n  \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e poll_ret = poll(fds, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (fds[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].revents \u0026#x26; POLLIN) {\n\n    \u003cspan class=\"hljs-comment\"\u003e/* obtained data for the first file descriptor */\u003c/span\u003e\n\n    \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003erange_finder_report\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003erangefinder_data\u003c/span\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e/* copy rangefinder data into local buffer */\u003c/span\u003e\n\n    orb_copy(ORB_ID(sensor_range_finder), rangefinder_sub_fd, \u0026#x26;rangefinder_data);\n    \u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Rangefinder distance:\\t%8.4f\\t%8.4f\\t%8.4f\\n\"\u003c/span\u003e, (\u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e)rangefinder_data.distance[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eStep 4: use it in your application\u003c/h2\u003e\n\u003cp\u003eThe code snippet above isn't a complete application, but you get the idea. Once the range finder data is copied into that \u003ccode\u003erange_finder_report\u003c/code\u003e struct instance, the sky is the limit (pun intended) for what you want to do to it. This is where higher level, application specific things get implemented. Some things I can think of to do with altimeter data:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eLog the data, fly the drone fleet in a lawnmower / zig zag pattern to try to cover a large area, and then use it for 3d reconstruction later. To do this you would also need a decent estimate of aircraft position and orientation.\u003c/li\u003e\n\u003cli\u003eTransmit data to a ground station for similar logging purposes. The ground station could be the central data aggregation point for the fleet. If the ground station has an internet connection, it could run a webserver for others to monitor aircraft data in real time from off-site.\u003c/li\u003e\n\u003cli\u003eImplement an automated landing routine. Would need to figure out at what speed / altitude you'd need to flare the aircraft right before touchdown.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWithout knowing any more details about the exact application, I think this is where I'll stop.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"flex flex-col justify-between items-center min-h-screen p-6 pt-0 \",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center mt-6 mb-2 md:mb-8 md:flex-row md:items-center md:justify-start\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-4 md:mb-0 md:mr-4 flex justify-center\",\"children\":[\"$\",\"$L9\",null,{\"src\":\"/icon.png\",\"alt\":\"Logo\",\"width\":100,\"height\":100,\"priority\":true}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center md:items-start\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-6xl font-serif mb-2\",\"children\":\"Stonelinks\"}],[\"$\",\"ul\",null,{\"className\":\"flex list-none gap-4\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/posts\",\"children\":\"Posts\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"About\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"max-w-3xl\",\"children\":[[\"$\",\"article\",null,{\"className\":\"p-5\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Laser Altimeter Integration on Pixhawk\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500 mt-0 mb-4\",\"children\":\"December 10, 2014\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2 mb-6\",\"children\":[[\"$\",\"$La\",\"0\",{\"className\":\"bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5\",\"href\":\"/tags/airplane\",\"children\":\"airplane\"}],[\"$\",\"$La\",\"1\",{\"className\":\"bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded px-2.5 py-0.5\",\"href\":\"/tags/drones\",\"children\":\"drones\"}]]}],\"$undefined\",\"$undefined\",[\"$\",\"div\",null,{\"className\":\"prose max-w-none mt-4\",\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-6\",\"children\":[[\"$\",\"hr\",null,{}],\"Â© \",[\"$\",\"$La\",null,{\"href\":\"/luke\",\"children\":\"Lucas Doyle\"}],\" \",2025]}]]}]]}]\nb:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\","])</script><script>self.__next_f.push([1,"{\"name\":\"theme-color\",\"content\":\"#ffffff\"}],[\"$\",\"meta\",\"2\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"3\",{\"children\":\"Laser Altimeter Integration on Pixhawk - Lucas Doyle - Personal Website | Stonelinks\"}],[\"$\",\"meta\",\"4\",{\"name\":\"description\",\"content\":\"Read this post by Lucas Doyle\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Laser Altimeter Integration on Pixhawk\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Read this post by Lucas Doyle\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:title\",\"content\":\"Laser Altimeter Integration on Pixhawk\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:description\",\"content\":\"Read this post by Lucas Doyle\"}],[\"$\",\"link\",\"10\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n4:null\n"])</script></body></html>