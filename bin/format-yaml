#!/bin/bash
set -ex

cd $PROJECT_ROOT

source .envrc

# Initialize an array to hold the file paths
files=()
yaml_files=()

# List all tracked files and untracked files not ignored by .gitignore
while IFS= read -r file; do
	files+=("$file")
done < <(
	git ls-files
	git ls-files --others --exclude-standard
)

# Filter array for files with .yaml or .yml extensions
for file in "${files[@]}"; do
	if [[ -f $file && ($file == *.yaml || $file == *.yml) ]]; then
		yaml_files+=("$file")
	fi
done

# Run yamllint and yamlfix on the filtered array
yamlfix "${yaml_files[@]}"
yamllint -f standard "${yaml_files[@]}"
